<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:c="http://java.sun.com/jsp/jstl/core">
    <c:set var="task" value="#{auctionTask.getAssetDtoList().get(auctionController.assetId)}"/>
    <c:set var="asset" value="#{auctionController.assetDto}"/>
    <c:set var="auctionRegister" value="#{auctionController.auctionRegister}" />

    <style>
        .detail-asset .product_description .product-meta {
            width: 75%;
        }
    </style>

    <div class="product_description">
        <div class="product-meta">
            <span style="font-weight: bold;">Giá khởi điểm</span>
            <span>
                <h:outputText value="#{asset.startingPrice}">
                    <f:convertNumber type="currency" currencySymbol="VNĐ" maxFractionDigits="6"
                                     minFractionDigits="0" locale="vi_VN"/>
                </h:outputText>
            </span>
        </div>
        <div class="product-meta">
            <span>Bước giá</span>
            <span>
                <h:outputText value="#{asset.priceStep}">
                    <f:convertNumber type="currency" currencySymbol="VNĐ" maxFractionDigits="6"
                                     minFractionDigits="0" locale="vi_VN"/>
                </h:outputText>
            </span>
        </div>
        <h:panelGroup rendered="#{asset.status ne DbConstant.ASSET_STATUS_PLAYING}">
            <div class="product-meta">
                <span>Tiền đặt trước</span>
                <span>
                    <h:outputText value="#{asset.deposit}">
                        <f:convertNumber type="currency" currencySymbol="VNĐ" maxFractionDigits="6"
                                         minFractionDigits="0" locale="vi_VN"/>
                    </h:outputText>
                </span>
            </div>
            <div class="product-meta">
                <span>Thời gian đăng ký tham gia</span>
                <span>Từ #{auctionController.convertDateToPattern(asset.startRegistrationDate)}</span>
            </div>
            <div class="product-meta">
                <span> </span>
                <span>đến #{auctionController.convertDateToPattern(asset.endRegistrationDate)}</span>
            </div>
        </h:panelGroup>
        <div class="product-meta">
            <span>Thời gian bắt đầu đấu giá</span><span>#{auctionController.convertDateToPattern(asset.startTime)}</span>
        </div>
        <div class="product-meta">
            <span>Hình thức đấu giá trực tuyến</span><span>#{asset.auctionFormalityName}</span>
        </div>
        <div class="product-meta">
            <span>Phương thức trả giá</span><span>#{asset.auctionMethodName}</span>
        </div>
        <h:panelGroup
                rendered="#{asset.auctionFormalityId eq DbConstant.AUCTION_FORMALITY_ID_POLL}">
            <div class="product-meta"><span>Số vòng đấu giá</span>
                <span>#{asset.numberOfRounds} vòng</span>
            </div>
            <div class="product-meta#{asset.assetFileList.size() ne 0 ? '' : ' no-border'}">
                <span>Thời gian mỗi vòng đấu giá</span><span>#{asset.timePerRound} phút</span>
            </div>
        </h:panelGroup>
        <h:panelGroup
                rendered="#{asset.auctionFormalityId eq DbConstant.AUCTION_FORMALITY_ID_DIRECT}">
            <h:panelGroup
                    rendered="#{asset.auctionMethodId eq DbConstant.AUCTION_METHOD_ID_UP}">
                <div class="product-meta#{asset.assetFileList.size() ne 0 ? '' : ' no-border'}">
                    <span>Thời gian trả giá</span><span>#{asset.timePerRound} phút</span>
                </div>
            </h:panelGroup>
            <h:panelGroup
                    rendered="#{asset.auctionMethodId eq DbConstant.AUCTION_METHOD_ID_DOWN}">
                <div class="product-meta#{asset.assetFileList.size() ne 0 ? '' : ' no-border'}">
                    <span>Thời gian hạ giá</span><span>#{asset.timePerRound} phút</span>
                </div>
            </h:panelGroup>
        </h:panelGroup>
        <h:panelGroup rendered="#{asset.assetFileList.size() ne 0}">
            <div class="product-meta no-border">
                <span>File đính kèm</span>
                <span>
                    <a href="#" role="button" id="dropdownMenuLink" data-toggle="dropdown" aria-haspopup="true"
                       aria-expanded="false">
                        <span>#{asset.assetFileList.size()} file đính kèm</span>
                            <i class="fa fa-caret-down" aria-hidden="true"/>
                    </a>
                    <div class="dropdown-menu" aria-labelledby="dropdownMenuLink">
                        <ui:repeat value="#{asset.assetFileList}" var="file">
                            <a class="dropdown-item" href="#{request.contextPath}/resources#{file.filePath}"><i class="fa fa-download"/> #{file.fileName}</a>
                        </ui:repeat>
                    </div>
                </span>
            </div>
        </h:panelGroup>

        <h:panelGroup id="#{Constant.AREA_WINNER}">

            <h:panelGroup rendered="#{authorizationFEController.hasLogged() and auctionRegister.status eq DbConstant.AUCTION_REGISTER_STATUS_WAITING and auctionRegister.statusRefund eq DbConstant.AUCTION_REGISTER_STATUS_REFUND_ZERO and asset.status eq DbConstant.ASSET_STATUS_WAITING}">
                <div class="status-icon">
                    <img src="#{resource['frontend-layout:images/unpaid-1.svg']}"/>
                </div>
            </h:panelGroup>

            <h:panelGroup rendered="#{authorizationFEController.hasLogged() and auctionRegister.status eq DbConstant.AUCTION_REGISTER_STATUS_ACCEPTED and auctionRegister.statusRefund eq DbConstant.AUCTION_REGISTER_STATUS_REFUND_THREE and asset.status eq DbConstant.ASSET_STATUS_WAITING}">
                <div class="status-icon">
                    <img src="#{resource['frontend-layout:images/register_success.svg']}"/>
                </div>
            </h:panelGroup>

            <h:panelGroup
                    rendered="#{authorizationFEController.hasLogged() and (asset.auctionRegisterStatus eq DbConstant.AUCTION_REGISTER_STATUS_REJECTED or asset.auctionRegisterStatus eq DbConstant.AUCTION_REGISTER_STATUS_REJECTED_JOIN )}">
                <div class="status-icon">
                    <img src="#{resource['frontend-layout:images/Reject.png']}"/>
                </div>
            </h:panelGroup>

            <h:panelGroup
                    rendered="#{authorizationFEController.hasLogged() and auctionRegister.statusRefund eq DbConstant.AUCTION_REGISTER_STATUS_REFUND_FOUR and (auctionRegister.status ne DbConstant.AUCTION_REGISTER_STATUS_REJECTED_JOIN and auctionRegister.status ne DbConstant.AUCTION_REGISTER_STATUS_REJECTED)}">
                <div class="status-icon">
                    <img src="#{resource['frontend-layout:images/comparing-checking.svg']}"/>
                </div>
            </h:panelGroup>

            <h:panelGroup id="#{Constant.AREA_IMAGE_WINNER}">
                <h:panelGroup
                        rendered="#{authorizationFEController.hasLogged()
                        and ((not empty task
                                and (task.inTimeConfirm or task.ended)
                                and !task.hasAllDeposit()
                                and task.accountIdWinner eq authorizationFEController.accountDto.accountId
                                and !task.cancel
                                and !task.refuseWinner)
                            or (asset.accountIdWinner eq authorizationFEController.accountDto.accountId
                                and asset.status ne DbConstant.ASSET_STATUS_NOT_SUCCESS))}">
                    <div class="status-icon">
                        <img src="#{resource['frontend-layout:images/success.svg']}"/>
                        <h:panelGroup rendered="#{asset.accountIdWinner eq authorizationFEController.accountDto.accountId}">
                            <style>
                                .status-icon {
                                    top: 25% !important;
                                }
                                .status-icon a {
                                    margin-top: 5px;
                                }
                            </style>
                            <!-- Button show contact -->
                            <br/>
                            <a class="btn btn-custom main-color" href="#" data-toggle="modal" data-target="#contactAfterEnd"
                               title="Liên hệ nhận giải">Liên hệ nhận giải</a>
                            <ui:include src="../modal/modal_contact_after_end.xhtml"/>
                        </h:panelGroup>
                    </div>
                </h:panelGroup>
            </h:panelGroup>
        </h:panelGroup>
    </div>
    
</ui:composition>
