<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:p="http://primefaces.org/ui"
                xmlns:c="http://java.sun.com/jsp/jstl/core"
                template="/admin/template/template.xhtml">

    <f:metadata>
        <f:event type="preRenderView" listener="#{assignAuctionController.initData()}"/>
    </f:metadata>

    <ui:define name="title">Phân công điều hành đấu giá</ui:define>

    <ui:define name="breadcrumb">
        <li>
            <p:link outcome="/admin/dieu-hanh-dau-gia/phan-cong-dieu-hanh-dau-gia">Phân công điều hành đấu giá</p:link>
        </li>
    </ui:define>

    <ui:define name="content">
        <p:dialog id="dlg" header="Chọn đấu giá viên" widgetVar="dialogInsertUpdate"
                  modal="true" width="400"
                  style="max-height: 90vh; max-width: 90vw"
                  rendered="#{assignAuctionController.getActions().hasAction(EAction.CHANGE_AUCTIONEER)}">
            <div class="ui-fluid">
                <h:form>
                    <p:selectOneMenu filter="true" filterMatchMode="contains"
                                     autoWidth="false" effect="fade"
                                     value="#{assignAuctionController.auctioneerId}">
                        <f:selectItem itemLabel="Chọn đấu giá viên" itemValue=""/>
                        <f:selectItems value="#{assignAuctionController.accountList}"/>
                    </p:selectOneMenu>
                    <p:panelGrid columns="2"
                                 columnClasses="ui-grid-col-1.5 ui-no-margin-padding, ui-grid-col-1.5 ui-no-margin-padding"
                                 layout="grid" styleClass="ui-panelgrid-blank" style="margin-top: 10px;">
                        <p:commandButton value="Lưu"
                                         actionListener="#{assignAuctionController.checkAuctioneer()}"
                                         icon="fa fa-save" style="width: 90px"
                                         styleClass="ui-panelgrid-blank"
                                         oncomplete="PF('dialogInsertUpdate').hide()"
                                         update="dialogWarn #{Constant.ERROR_GROWL_ID}">
                        </p:commandButton>
                        <p:commandButton value="Đóng" icon="fa fa-close" style="width: 80px; margin-left: 10px;"
                                         global="false"
                                         oncomplete="PF('dialogInsertUpdate').hide()"
                                         update="dlg" styleClass="close">
                        </p:commandButton>
                    </p:panelGrid>
                </h:form>
            </div>
        </p:dialog>

        <p:dialog id="dlg2" header="Cảnh báo" widgetVar="dialogWarn"
                  style="max-height: 90vh; max-width: 90vw"
                  modal="true" width="400">
            <div class="ui-fluid">
                <h:form id="dialogWarn">
                    <h:outputText value="Đấu giá viên &lt;b&gt;#{assignAuctionController.auctioneerName}&lt;/b&gt; đã được phân công #{assignAuctionController.auctioneerCount} cuộc đấu giá khác trong ngày, bạn có chắc chắn muốn phân công không ?" escape="false"/>
                    <p:panelGrid columns="2"
                                 columnClasses="ui-grid-col-1.5 ui-no-margin-padding, ui-grid-col-1.5 ui-no-margin-padding"
                                 layout="grid" styleClass="ui-panelgrid-blank" style="margin-top: 10px;">
                        <p:commandButton value="Đồng ý"
                                         actionListener="#{assignAuctionController.onSave()}"
                                         icon="fa fa-save" style="width: 90px"
                                         styleClass="ui-panelgrid-blank"
                                         oncomplete="PF('dialogWarn').hide()"
                                         update="#{Constant.ERROR_GROWL_ID}">
                        </p:commandButton>
                        <p:commandButton value="Hủy" icon="fa fa-close" style="width: 80px; margin-left: 10px;"
                                         oncomplete="PF('dialogWarn').hide()"
                                         update="dlg2" styleClass="close">
                        </p:commandButton>
                    </p:panelGrid>
                </h:form>
            </div>
        </p:dialog>

        <p:dialog id="detailInfoDialog" header="Quy chế đấu giá" widgetVar="detailInfoDialog"
                  modal="true" position="top center" showEffect="clip" hideEffect="clip"
                  styleClass="text-center"
                  style="max-height: 90vh; max-width: 90vw"
                  width="800" height="600">
            <p:scrollPanel mode="native"
                           style="width: 100%; height: 100%; border: none; overflow-y: hidden;">
                <p:media value="/resources#{assignAuctionController.regulationFilePath}" player="pdf" width="100%" height="100%">
                    Không thể hiển thị được file tải lên, <h:outputLink value="#{request.contextPath}/resources#{assignAuctionController.regulationFilePath}">bấm vào đây</h:outputLink> để tải file về
                </p:media>
            </p:scrollPanel>
        </p:dialog>

        <h:form id="searchForm">
            <div class="ui-fluid">
                <div class="ui-g">
                    <div class="ui-g-12" style="padding-top:0">
                        <div class="card no-margin">
                            <p:panel id="searchCode" header="Tìm kiếm phiên đấu giá#{not empty request.getParameter('auctioneerId') ? ': Chưa phân công đấu giá viên' : ''}" style="margin-bottom:5px"
                                     rendered="#{assignAuctionController.getActions().canSearch()}">
                                <p:panelGrid id="searchPanel" columns="4"
                                             columnClasses="ui-grid-col-2,ui-grid-col-4,ui-grid-col-2,ui-grid-col-4"
                                             styleClass="ui-panelgrid-blank" layout="grid">

                                    <h:outputLabel value="Mã quy chế: " for="code"/>
                                    <p:inputText value="#{assignAuctionController.assignAuctionSearchDto.code}"
                                                 placeholder="Nhập mã quy chế" id="code"/>

                                    <h:outputLabel value="Tên người có tài sản: " for="peopleWAsset"/>
                                    <p:inputText value="#{assignAuctionController.assignAuctionSearchDto.peopleWAsset}"
                                                 placeholder="Nhập tên người có tài sản" id="peopleWAsset"/>
                                    <p:outputLabel value="Thời gian bắt đầu cuộc đấu giá:"/>
                                    <p:panelGrid id="searchPanelDate" columns="3"
                                                 columnClasses="ui-grid-col-5 ui-no-margin-padding, ui-grid-col-2 ui-no-margin-padding, ui-grid-col-5 ui-no-margin-padding"
                                                 styleClass="ui-panelgrid-blank" layout="grid">
                                        <p:calendar styleClass="calendar" id="startTime"
                                                    navigator="true" mode="popup" placeholder="Từ ngày"
                                                    autocomplete="off"
                                                    disabled="false"
                                                    converterMessage="Thời gian bắt đầu cuộc đấu giá không hợp lệ "
                                                    pattern="dd/MM/yyyy"
                                                    validatorMessage="Nhập thời gian bắt đầu từ ngày phải nhỏ hơn đến ngày"
                                                    value="#{assignAuctionController.assignAuctionSearchDto.fromDate}"
                                                    maxdate="#{assignAuctionController.assignAuctionSearchDto.toDate}">
                                            <p:ajax event="dateSelect"
                                                    global="false" process="@this"
                                                    listener="#{assignAuctionController.onDateSelect}"
                                                    update="endTime"/>
                                            <p:ajax event="change"
                                                    global="false" process="@this"
                                                    listener="#{assignAuctionController.onDateSelect}"
                                                    update="endTime"/>
                                        </p:calendar>
                                        <p:outputLabel value=""/>
                                        <p:calendar styleClass="calendar"
                                                    navigator="true" mode="popup" placeholder="Đến ngày"
                                                    validatorMessage="Nhập thời gian bắt đầu đến ngày phải lớn hơn từ ngày"
                                                    converterMessage="Thời gian bắt đầu cuộc đấu giá không hợp lệ "
                                                    disabled="false"
                                                    pattern="dd/MM/yyyy"
                                                    autocomplete="off" id="endTime"
                                                    value="#{assignAuctionController.assignAuctionSearchDto.toDate}"
                                                    mindate="#{assignAuctionController.assignAuctionSearchDto.fromDate}">
                                            <p:ajax event="dateSelect"
                                                    global="false" process="@this"
                                                    listener="#{assignAuctionController.onDateSelect}"
                                                    update="startTime"/>
                                            <p:ajax event="change"
                                                    global="false" process="@this"
                                                    listener="#{assignAuctionController.onDateSelect}"
                                                    update="startTime"/>
                                        </p:calendar>

                                    </p:panelGrid>
                                    <h:outputLabel value="Trạng thái: " for="status"/>
                                    <p:selectOneMenu id="status"
                                                     value="#{assignAuctionController.assignAuctionSearchDto.auctionStatus}">
                                        <f:selectItem itemLabel="Tất cả" itemValue=""/>
                                        <f:selectItem itemLabel="#{DbConstant.ASSIGN_AUCTION_STATUS_1}"
                                                      itemValue="#{DbConstant.REGULATION_AUCTION_STATUS_WAITING}"/>
                                        <f:selectItem itemLabel="#{DbConstant.ASSIGN_AUCTION_STATUS_2}"
                                                      itemValue="#{DbConstant.REGULATION_AUCTION_STATUS_PLAYING}"/>
                                        <f:selectItem itemLabel="#{DbConstant.ASSIGN_AUCTION_STATUS_3}"
                                                      itemValue="#{DbConstant.REGULATION_AUCTION_STATUS_ENDED}"/>
                                        <f:selectItem itemLabel="#{DbConstant.ASSIGN_AUCTION_STATUS_4}"
                                                      itemValue="#{DbConstant.REGULATION_AUCTION_STATUS_CANCELLED}"/>
                                    </p:selectOneMenu>

                                    <h:outputLabel value="Đấu giá viên: " for="auctioneer"/>
                                    <p:selectOneMenu id="auctioneer"
                                                     value="#{assignAuctionController.assignAuctionSearchDto.auctioneerId}">
                                        <f:selectItem itemLabel="Tất cả" itemValue=""/>
                                        <f:selectItems value="#{assignAuctionController.accountList}"/>
                                    </p:selectOneMenu>

                                </p:panelGrid>

                                <p:panelGrid columns="3"
                                             columnClasses="ui-grid-col-1.5,ui-grid-col-1.5,ui-grid-col-1.5"
                                             styleClass="ui-panelgrid-blank" layout="grid">
                                    <p:commandButton value="Tìm kiếm"
                                                     actionListener="#{assignAuctionController.onSearch()}"
                                                     update="searchForm tblSearchResult growl" icon="fa fa-search"/>
                                    <p:commandButton value="Làm mới" process="@parent"
                                                     action="#{assignAuctionController.resetAll()}"
                                                     update="searchForm tblSearchResult" icon="fa fa-refresh"
                                                     styleClass="orange-btn">
                                    </p:commandButton>
                                    <p:commandButton value="Xuất dữ liệu" icon="fa fa-copy" update="growl" ajax="false" rendered="#{assignAuctionController.lazyDataModel.rowCount gt 0}">
                                        <p:dataExporter type="xlsxstream" target="tblSearchResult" fileName="Danh sách thông tin phân công đấu giá viên" />
                                    </p:commandButton>
                                </p:panelGrid>
                            </p:panel>

                            <p:panel id="searchResult" header="Kết quả tìm kiếm" style="margin-bottom:5px">
                                <p:dataTable id="tblSearchResult" tableStyle="table-layout: auto;"
                                             widgetVar="wdgNhomQuyen" resizableColumns="true" paginator="true"
                                             rows="10"
                                             value="#{assignAuctionController.lazyDataModel}"
                                             lazy="true" pageLinks="5" paginatorPosition="top" var="resultDto"
                                             paginatorAlwaysVisible="true" rowsPerPageTemplate="10,20,50,100"
                                             paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                                             currentPageReportTemplate="#{t['lbl.recordTotal']}: #{assignAuctionController.lazyDataModel.rowCount}"
                                             emptyMessage="#{t['lbl.emptyTable']}" rowIndexVar="rowIndex"
                                             rowKey="#{resultDto.regulationId}">

                                    <p:column headerText="Chi tiết" style="width: 20px;" exportable="false"
                                              rendered="#{assignAuctionController.getActions().canDetail()}">
                                        <p:rowToggler />
                                    </p:column>

                                    <p:column headerText="STT" width="30" style="text-align: center">
                                        <h:outputText value="#{rowIndex + 1}"/>
                                    </p:column>

                                    <p:column headerText="Mã quy chế" sortBy="#{resultDto.code}" visible="false" width="10%">
                                        <h:outputText value="#{resultDto.code}"/>
                                    </p:column>

                                    <p:column headerText="Mã quy chế" sortBy="#{resultDto.code}" exportable="false" width="10%" style="text-align: center">
                                        <p:commandLink value="#{resultDto.code}"
                                                       style="text-decoration: underline"
                                                       actionListener="#{assignAuctionController.onShowRegulationFile(resultDto.filePath)}"
                                                       update="detailInfoDialog"
                                                       oncomplete="PF('detailInfoDialog').show();"/>
                                    </p:column>

                                    <p:column headerText="Tên danh mục tài sản" exportable="false">
                                        <h:outputText value="#{commonController.abbreviate(resultDto.assetName, DbConstant.LIMITCHARACTER)}"/>
                                    </p:column>

                                    <p:column headerText="Tên danh mục tài sản" visible="false">
                                        <h:outputText value="#{resultDto.assetName}"/>
                                    </p:column>

                                    <p:column headerText="Người có tài sản" width="10%">
                                        <h:outputText value="#{resultDto.orgName}" rendered="#{not empty resultDto.orgName}"/>
                                        <h:outputText value="N/A" rendered="#{empty resultDto.orgName}"/>
                                    </p:column>

                                    <p:column headerText="Đấu giá viên" sortBy="#{resultDto.auctioneerName}" width="10%">
                                        <h:outputText value="#{resultDto.auctioneerName}"
                                                      rendered="#{not empty resultDto.auctioneerName}"/>
                                        <h:outputText value="Chưa phân công đấu giá viên" rendered="#{empty resultDto.auctioneerName}"/>
                                    </p:column>

                                    <p:column headerText="Hình thức đấu giá trực tuyến" sortBy="#{resultDto.auctionFormalityName}" width="10%">
                                        <h:outputText value="#{resultDto.auctionFormalityName}"/>
                                    </p:column>

                                    <p:column headerText="Phương thức đấu giá" width="10%"
                                              sortBy="#{resultDto.auctionMethodName}">
                                        <h:outputText value="#{resultDto.auctionMethodName}"/>
                                    </p:column>

                                    <p:column headerText="Thời gian bắt đầu cuộc đấu giá" sortBy="#{resultDto.startTime}"
                                              style="text-align: center;" width="10%">
                                        <h:outputText value="#{resultDto.startTime}">
                                            <f:convertDateTime pattern="HH:mm, dd/MM/yyyy"/>
                                        </h:outputText>
                                    </p:column>

                                    <p:column headerText="Trạng thái" sortBy="#{resultDto.auctionStatus}" width="10%">
                                        <h:outputText value="#{DbConstant.ASSIGN_AUCTION_STATUS_1}"
                                                      rendered="#{resultDto.auctionStatus eq DbConstant.REGULATION_AUCTION_STATUS_WAITING and resultDto.regulationStatus ne DbConstant.REGULATION_STATUS_CANCELED}"/>
                                        <h:outputText value="#{DbConstant.ASSIGN_AUCTION_STATUS_2}"
                                                      rendered="#{resultDto.auctionStatus eq DbConstant.REGULATION_AUCTION_STATUS_PLAYING and resultDto.regulationStatus ne DbConstant.REGULATION_STATUS_CANCELED}"/>
                                        <h:outputText value="#{DbConstant.ASSIGN_AUCTION_STATUS_3}"
                                                      rendered="#{resultDto.auctionStatus eq DbConstant.REGULATION_AUCTION_STATUS_ENDED and resultDto.regulationStatus ne DbConstant.REGULATION_STATUS_CANCELED}"/>
                                        <h:outputText value="#{DbConstant.ASSIGN_AUCTION_STATUS_4}"
                                                      rendered="#{resultDto.auctionStatus eq DbConstant.REGULATION_AUCTION_STATUS_CANCELLED and resultDto.regulationStatus eq DbConstant.REGULATION_STATUS_CANCELED}"/>
                                    </p:column>

                                    <p:column headerText="Thời gian mỗi vòng " visible="hidden">
                                        <h:outputText value="#{resultDto.timePerRound} phút" rendered="#{resultDto.auctionFormalityId eq DbConstant.AUCTION_FORMALITY_ID_POLL}"/>
                                    </p:column>

                                    <p:column headerText="Thời gian kết thúc " visible="hidden">
                                        <h:outputText value="#{resultDto.timePerRound} phút" rendered="#{resultDto.auctionFormalityId eq DbConstant.AUCTION_FORMALITY_ID_DIRECT}"/>
                                    </p:column>

                                    <p:column headerText="Thời gian bắt đầu đăng ký " visible="hidden">
                                        <h:outputText value="#{resultDto.startRegistrationDate}">
                                            <f:convertDateTime pattern="HH:mm, dd/MM/yyyy"/>
                                        </h:outputText>
                                    </p:column>

                                    <p:column headerText="Thời gian kết thúc đăng ký " visible="hidden">
                                        <h:outputText value="#{resultDto.endRegistrationDate}">
                                            <f:convertDateTime pattern="HH:mm, dd/MM/yyyy"/>
                                        </h:outputText>
                                    </p:column>

                                    <p:column headerText="Tùy chọn hiển thị " visible="hidden">
                                        <h:outputText value="Hiển thị công khai diễn biến cuộc đấu giá"
                                                      rendered="#{resultDto.historyStatus}"/>
                                        <h:outputText value="Không hiển thị công khai diễn biến cuộc đấu giá"
                                                      rendered="#{!resultDto.historyStatus}"/>
                                    </p:column>

                                    <p:rowExpansion rendered="#{assignAuctionController.getActions().canDetail()}">

                                        <p:panelGrid columns="4" layout="grid" rendered="#{assignAuctionController.renderCountString(resultDto.assetName)}" columnClasses="ui-grid-col-2,ui-grid-col-4,ui-grid-col-2,ui-grid-col-4" styleClass="ui-panelgrid-blank">
                                            <p:outputLabel value="Mã quy chế: "/>
                                            <h:outputText value="#{resultDto.code}"/>
                                            <p:outputLabel value="Tên danh mục tài sản: "/>
                                            <h:outputText value="#{resultDto.assetName}"/>
                                        </p:panelGrid>

                                        <p:panelGrid columns="2" layout="grid" rendered="#{!assignAuctionController.renderCountString(resultDto.assetName)}" columnClasses="ui-grid-col-2,ui-grid-col-10" styleClass="ui-panelgrid-blank">
                                            <p:outputLabel value="Mã quy chế: "/>
                                            <h:outputText value="#{resultDto.code}"/>
                                        </p:panelGrid>

                                        <p:panelGrid columns="2" layout="grid" rendered="#{!assignAuctionController.renderCountString(resultDto.assetName)}" columnClasses="ui-grid-col-2,ui-grid-col-10 text-limit-width" styleClass="ui-panelgrid-blank">
                                            <p:outputLabel value="Tên danh mục tài sản: "/>
                                            <h:outputText value="#{resultDto.assetName}"/>
                                        </p:panelGrid>

                                        <p:panelGrid id="detail-content" columns="4" layout="grid"
                                                     styleClass="ui-panelgrid-blank"
                                                     columnClasses="ui-grid-col-2,ui-grid-col-4,ui-grid-col-2,ui-grid-col-4">
                                            <p:outputLabel value="Người có tài sản: "/>
                                            <h:outputText value="#{resultDto.orgName}"/>

                                            <p:outputLabel value="Đấu giá viên: " rendered="#{resultDto.regulationStatus ne DbConstant.REGULATION_STATUS_CANCELED}"/>
                                            <h:outputText value="#{resultDto.auctioneerName}"
                                                          rendered="#{not empty resultDto.auctioneerName and resultDto.regulationStatus ne DbConstant.REGULATION_STATUS_CANCELED}"/>
                                            <h:outputText value="Chưa phân công đấu giá viên" rendered="#{empty resultDto.auctioneerName and resultDto.regulationStatus ne DbConstant.REGULATION_STATUS_CANCELED}"/>

                                            <p:outputLabel value="Hình thức đấu giá trực tuyến: "/>
                                            <h:outputText value="#{resultDto.auctionFormalityName}"/>

                                            <p:outputLabel value="Phương thức đấu giá: "/>
                                            <h:outputText value="#{resultDto.auctionMethodName}"/>

                                            <p:outputLabel value="Thời gian bắt đầu: "/>
                                            <h:outputText value="#{resultDto.startTime}">
                                                <f:convertDateTime pattern="HH:mm, dd/MM/yyyy"/>
                                            </h:outputText>

                                            <p:outputLabel value="Trạng thái: "/>
                                            <h:outputText value="#{DbConstant.ASSIGN_AUCTION_STATUS_1}"
                                                          rendered="#{resultDto.auctionStatus eq DbConstant.REGULATION_AUCTION_STATUS_WAITING and resultDto.regulationStatus ne DbConstant.REGULATION_STATUS_CANCELED}"/>
                                            <h:outputText value="#{DbConstant.ASSIGN_AUCTION_STATUS_2}"
                                                          rendered="#{resultDto.auctionStatus eq DbConstant.REGULATION_AUCTION_STATUS_PLAYING and resultDto.regulationStatus ne DbConstant.REGULATION_STATUS_CANCELED}"/>
                                            <h:outputText value="#{DbConstant.ASSIGN_AUCTION_STATUS_3}"
                                                          rendered="#{resultDto.auctionStatus eq DbConstant.REGULATION_AUCTION_STATUS_ENDED and resultDto.regulationStatus ne DbConstant.REGULATION_STATUS_CANCELED}"/>
                                            <h:outputText value="#{DbConstant.ASSIGN_AUCTION_STATUS_4}"
                                                          rendered="#{resultDto.auctionStatus eq DbConstant.REGULATION_AUCTION_STATUS_CANCELLED and resultDto.regulationStatus eq DbConstant.REGULATION_STATUS_CANCELED}"/>

                                            <p:outputLabel value="Thời gian mỗi vòng: " rendered="#{resultDto.auctionFormalityId eq DbConstant.AUCTION_FORMALITY_ID_POLL}"/>
                                            <p:outputLabel value="Thời gian kết thúc: " rendered="#{resultDto.auctionFormalityId eq DbConstant.AUCTION_FORMALITY_ID_DIRECT}"/>
                                            <h:outputText value="#{resultDto.timePerRound} phút"/>

                                            <p:outputLabel value="Thời gian bắt đầu đăng ký: "/>
                                            <h:outputText value="#{resultDto.startRegistrationDate}">
                                                <f:convertDateTime pattern="HH:mm, dd/MM/yyyy"/>
                                            </h:outputText>

                                            <p:outputLabel value="Thời gian kết thúc đăng ký: "/>
                                            <h:outputText value="#{resultDto.endRegistrationDate}">
                                                <f:convertDateTime pattern="HH:mm, dd/MM/yyyy"/>
                                            </h:outputText>

                                            <p:outputLabel value="Tùy chọn hiển thị: "/>
                                            <h:outputText value="Hiển thị công khai diễn biến cuộc đấu giá"
                                                          rendered="#{resultDto.historyStatus}"/>
                                            <h:outputText value="Không hiển thị công khai diễn biến cuộc đấu giá"
                                                          rendered="#{!resultDto.historyStatus}"/>

                                        </p:panelGrid>
                                    </p:rowExpansion>

                                    <p:column headerText="Thao tác" width="40" exportable="false">
                                        <p:menuButton icon="fa fa-cogs">
                                            <p:menuitem oncomplete="PF('dialogInsertUpdate').show();"
                                                        update="dlg #{Constant.ERROR_GROWL_ID}"
                                                        actionListener="#{assignAuctionController.showUpdatePopup(resultDto)}"
                                                        value="Chọn đấu giá viên"
                                                        icon="fa fa-user"
                                                        rendered="#{assignAuctionController.getActions().hasAction(EAction.CHANGE_AUCTIONEER) and resultDto.auctionStatus == DbConstant.REGULATION_AUCTION_STATUS_WAITING and resultDto.regulationStatus ne DbConstant.REGULATION_STATUS_CANCELED}"/>
                                            <p:menuitem value="Chi tiết cuộc đấu giá"
                                                        rendered="#{assignAuctionController.getActions().hasAction(EAction.VIEW_ASSET)}"
                                                        actionListener="#{assignAuctionController.onRedirectListAsset(resultDto.regulationId)}"
                                                        update="tblSearchResult growl" icon="fa fa-eye"/>
                                            <p:menuitem value="Xuất lịch sử trả giá"
                                                        ajax="false"
                                                        rendered="#{resultDto.auctionStatus eq DbConstant.REGULATION_AUCTION_STATUS_ENDED  or resultDto.auctionStatus eq DbConstant.REGULATION_AUCTION_STATUS_CANCELLED}"
                                                        onclick="PrimeFaces.monitorDownload(start, stop);"
                                                        update="growl"
                                                        icon="fa fa-copy"
                                                        style="width: auto;">
                                                <p:fileDownload
                                                        value="#{assignAuctionController.downloadHistoryBargain(resultDto)}"/>
                                            </p:menuitem>

                                            <p:menuitem value="Xem lý do tạm dừng" update="tblSearchResult growl dlForm"
                                                        oncomplete="PF('dialogReasonCancel').show();"
                                                        icon="fa fa-eye"
                                                        actionListener="#{assignAuctionController.showReasonPopup(resultDto.regulationId)}"
                                                        rendered="#{auctionManageController.getActions().hasAction(EAction.VIEW_REASON_CANCEL) and resultDto.auctionStatus eq DbConstant.REGULATION_AUCTION_STATUS_CANCELLED}"/>
                                        </p:menuButton>
                                    </p:column>
                                </p:dataTable>

                            </p:panel>
                        </div>
                    </div>
                </div>
            </div>
        </h:form>
        <p:dialog header="Lý do tạm dừng phiên đấu giá" id="dlg1"
                  style="max-height: 90vh; max-width: 90vw"
                  rendered="#{auctionManageController.getActions().hasAction(EAction.CANCEL, EAction.VIEW_REASON_CANCEL)}"
                  widgetVar="dialogReasonCancel" modal="true" width="810">
            <h:form enctype="multipart/form-data" id="dlForm">
                <div class="ui-fluid">
                    <p:panelGrid id="basicPanel1" columns="2"
                                 columnClasses="ui-grid-col-2, ui-grid-col-10"
                                 styleClass="ui-panelgrid-blank" layout="grid">

                        <p:outputLabel value="Lý do tạm dừng:" styleClass="requireLabel" for="reason"/>
                        <p:inputTextarea id="reason" placeholder="Nhập lý do tạm dừng cuộc đấu giá"
                                         rows="6" cols="33" maxlength="1000"
                                         disabled="#{assignAuctionController.disableReason}"
                                         value="#{assignAuctionController.regulation.reasonCancel}"/>

                        <p:outputLabel styleClass="requireLabel" value="Tải file văn bản:"/>
                        <p:outputPanel rendered="#{!assignAuctionController.disableReason}">
                            <ui:include src="/common/upload-single-file.xhtml"/>
                        </p:outputPanel>

                        <p:outputLabel rendered="#{!assignAuctionController.disableReason}"/>
                        <p:outputLabel rendered="#{!assignAuctionController.disableReason}"
                                       value="(Vui lòng chọn tài liệu định dạng PDF, DOCX, JPG, JPEG, PNG dung lượng ảnh nhỏ hơn 5MB)"/>
                        <p:outputPanel rendered="#{assignAuctionController.disableReason}">
                            <p:commandButton value="Tải về" style="width:80px;" ajax="false" immediate="true"
                                             icon="fa fa-fw fa-download">
                                <p:fileDownload value="#{assignAuctionController.downloadReasonFile()}"/>
                            </p:commandButton>
                        </p:outputPanel>
                    </p:panelGrid>

                    <p:panelGrid columns="3"
                                 columnClasses="ui-grid-col-1.5,ui-grid-col-1.5,ui-grid-col-1.5"
                                 layout="grid" styleClass="ui-panelgrid-blank">
                        <p:commandButton value="Đóng" styleClass="close" icon="fa fa-remove"
                                         global="false"
                                         oncomplete="PF('dialogReasonCancel').hide()"
                                         style="width: auto;"/>
                    </p:panelGrid>
                </div>
            </h:form>
        </p:dialog>
    </ui:define>
</ui:composition>
