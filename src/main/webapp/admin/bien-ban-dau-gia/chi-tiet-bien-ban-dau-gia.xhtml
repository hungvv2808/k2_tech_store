<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:p="http://primefaces.org/ui"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                template="/admin/template/template.xhtml">

    <ui:define name="title">Chi tiết biên bản đấu giá</ui:define>

    <ui:define name="breadcrumb">
        <li>
            <p:link outcome="/admin/bien-ban-dau-gia/chi-tiet-bien-ban-dau-gia">Lưu trữ biên bản đấu giá / Chi tiết biên bản đấu giá</p:link>
        </li>
    </ui:define>

    <ui:define name="content">

        <div class="ui-fluid">
            <div class="card no-margin">
                <h:form id="mainForm" prependId="false">
                    <p:panel header="Chi tiết quy chế" style="margin-bottom: 10px;">

                        <p:panelGrid columns="4" styleClass="ui-panelgrid-blank" layout="grid"
                                     columnClasses="ui-grid-col-2,ui-grid-col-4,ui-grid-col-2,ui-grid-col-4">

                            <p:outputLabel value="Mã quy chế: "/>
                            <p:outputLabel value="#{reportAuctionController.regulationDto.code}"/>

                            <p:outputLabel value="Hình thức đấu giá trực tuyến: "/>
                            <p:outputLabel value="#{reportAuctionController.regulationDto.auctionFormalityName}"/>

                            <p:outputLabel value="Phương thức đấu giá: "/>
                            <p:outputLabel value="#{reportAuctionController.regulationDto.auctionMethodName}"/>

                            <p:outputLabel value="Thời gian bắt đầu cuộc đấu giá: "/>
                            <p:outputLabel value="#{reportAuctionController.regulationDto.startTime}">
                                <f:convertDateTime pattern="HH:mm, dd/MM/yyyy"/>
                            </p:outputLabel>

                        </p:panelGrid>
                        <p:panelGrid id="dlFrom" columns="2" styleClass="ui-panelgrid-blank" layout="grid"
                                     columnClasses="ui-grid-col-2,ui-grid-col-6">
                            <p:outputLabel value="File biên bản cuộc đấu giá: "/>

                            <p:outputPanel>
                                <p:fileUpload id="fileUpload" mode="advanced"
                                              auto="true" label="Tải file"
                                              onstart="PF('statusDialog').show();"
                                              oncomplete="PF('statusDialog').hide();"
                                              fileUploadListener="#{uploadSingleFileRegulationController.onUploadFilePDF}"
                                              update="mainForm #{Constant.ERROR_GROWL_ID}"/>

                                <p:outputPanel id="singleFile" style="margin-top: 15px;"
                                               rendered="#{not empty uploadSingleFileRegulationController.filePath}">
                                    <i class="fa fa-fw fa-file"/>
                                    <p:commandLink value="#{uploadSingleFileRegulationController.fileName}"
                                                   immediate="true" ajax="false"
                                                   style="margin-left: 10px;">
                                        <p:fileDownload
                                                value="#{uploadSingleFileRegulationController.getFileDownload(uploadSingleFileRegulationController.filePath)}"/>
                                    </p:commandLink>
                                    <p:commandLink styleClass="delete" style="margin-left: 20px;"  update="mainForm"
                                                   rendered="#{reportAuctionController.regulationReportFile.status eq DbConstant.REGULATION_REPORT_FILE_STATUS_NOT_YET}"
                                                   actionListener="#{uploadSingleFileRegulationController.onRemoveFile()}">
                                        <p:confirm header="Xác nhận xóa" message="Bạn chắc chắn muốn xóa ?"
                                                   icon="fa fa-question-circle"/>
                                        <i class="fa fa-remove"/>
                                    </p:commandLink>

                                </p:outputPanel>
                            </p:outputPanel>
                        </p:panelGrid>
                    </p:panel>

                    <p:panel header="Danh sách tài sản">
                        <p:dataTable value="#{reportAuctionController.assetDtoList}"
                                     id="dataTable" selection="#{reportAuctionController.assetDtoSelected}"
                                     var="resultDto" rowIndexVar="rowIndex" rowKey="#{resultDto.assetId}"
                                     disabledSelection="#{reportAuctionController.disableCheckBox(resultDto)}">

                            <p:ajax event="rowSelectCheckbox" process="@this"/>
                            <p:ajax event="rowUnselectCheckbox" process="@this"/>
                            <p:ajax event="toggleSelect" process="@this"/>

                            <p:column selectionMode="multiple" style="text-align:center" width="20"/>

                            <p:column headerText="STT" width="30" style="text-align: center">
                                <p:outputLabel value="#{rowIndex + 1}"/>
                            </p:column>

                            <p:column headerText="Tên tài sản">
                                <p:outputLabel title="#{resultDto.name}"
                                        value="#{commonController.abbreviate(resultDto.name, DbConstant.LIMITCHARACTER_HOME)}"/>
                            </p:column>

                            <p:column headerText="Trạng thái đấu giá" style="text-align: center" width="12%">
                                <p:outputLabel value="Đã tạm dừng" rendered="#{resultDto.status eq DbConstant.ASSET_STATUS_CANCELED}"/>
                                <p:outputLabel value="Thành công" rendered="#{resultDto.status eq DbConstant.ASSET_STATUS_ENDED and resultDto.assetManagementEnding eq DbConstant.ASSET_MANAGEMENT_ENDING_GOOD}"/>
                                <p:outputLabel value="Thất bại" rendered="#{resultDto.status eq DbConstant.ASSET_STATUS_ENDED and resultDto.assetManagementEnding eq DbConstant.ASSET_MANAGEMENT_ENDING_BAD}"/>
                            </p:column>

                            <p:column headerText="Người trúng đấu giá" style="text-align: center" width="12%">
                                <p:outputLabel value="#{resultDto.fullNameRegister}" rendered="#{resultDto.fullNameRegister ne null}"/>
                                <p:outputLabel value="N/A" rendered="#{resultDto.fullNameRegister eq null}"/>
                            </p:column>

                            <p:column headerText="Giá trúng đấu giá" style="text-align: center" width="12%">
                                <p:outputLabel value="#{resultDto.winPrice}" rendered="#{resultDto.winPrice ne null}">
                                    <f:convertNumber type="currency" currencySymbol="VNĐ" maxFractionDigits="6"
                                                     minFractionDigits="0" locale="vi_VN"/>
                                </p:outputLabel>
                                <p:outputLabel value="N/A" rendered="#{resultDto.winPrice eq null}"/>
                            </p:column>

                            <p:column headerText="Thời gian kết thúc" style="text-align: center" width="12%">
                                <p:outputLabel value="#{resultDto.timeRecorded}" rendered="#{resultDto.timeRecorded ne null}">
                                    <f:convertDateTime pattern="HH:mm, dd/MM/yyyy"/>
                                </p:outputLabel>
                                <p:outputLabel value="N/A" rendered="#{resultDto.timeRecorded eq null}"/>
                            </p:column>

                            <p:column headerText="Trạng thái ký số" style="text-align: center" width="12%">
                                <p:outputLabel value="N/A" rendered="#{resultDto.status eq DbConstant.ASSET_STATUS_ENDED and resultDto.assetManagementEnding eq DbConstant.ASSET_MANAGEMENT_ENDING_BAD}"/>
                                <p:outputLabel value="Chưa ký số" rendered="#{resultDto.statusSigned eq null and resultDto.status eq DbConstant.ASSET_STATUS_ENDED and resultDto.assetManagementEnding eq DbConstant.ASSET_MANAGEMENT_ENDING_GOOD}"/>
                                <p:outputLabel value="Đã ký số" rendered="#{resultDto.statusSigned eq DbConstant.REGULATION_REPORT_USER_SIGNED and resultDto.status eq DbConstant.ASSET_STATUS_ENDED and resultDto.assetManagementEnding eq DbConstant.ASSET_MANAGEMENT_ENDING_GOOD}"/>
                            </p:column>

                            <p:column headerText="File trả về" style="text-align: center" width="12%">
                                <p:outputLabel value="N/A" rendered="#{reportAuctionController.renderedStatusFile(resultDto)}"/>
                                <p:commandLink value="#{resultDto.fileNameReport}" immediate="true" ajax="false" style="color: white; text-decoration: underline"
                                               rendered="#{resultDto.statusSigned eq DbConstant.REGULATION_REPORT_USER_SIGNED}">
                                    <p:fileDownload value="#{reportAuctionController.getFileDownload(resultDto.filePathReport)}"/>
                                </p:commandLink>
                            </p:column>

                        </p:dataTable>
                    </p:panel>

                    <p:outputPanel>
                        <p:commandButton value="Gửi biên bản"
                                         disabled="#{reportAuctionController.regulationReportFile.status ne DbConstant.REGULATION_REPORT_FILE_STATUS_NOT_YET}"
                                         style="width: auto; margin-top: 10px;" update="mainForm growl"
                                         actionListener="#{reportAuctionController.checkValidate()}" icon="fa fa-send">
                        </p:commandButton>
                        <p:confirmDialog header="Thông báo" widgetVar="confirmDialog"
                                         message="Bạn có chắc chắn muốn gửi biên bản đấu giá này hay không?"
                                         icon="fa fa-question-circle">
                            <p:outputPanel style="text-align: right">
                                <p:commandButton value="Đồng ý" style="width: auto" styleClass="ui-confirmdialog-yes"
                                                 actionListener="#{reportAuctionController.sendReportAuction()}"
                                                 process="@this" update="mainForm growl"/>
                                <p:commandButton value="Hủy bỏ" style="width: auto"
                                                 styleClass="ui-confirmdialog-no close"
                                                 oncomplete="PF('confirmDialog').hide()"/>
                            </p:outputPanel>
                        </p:confirmDialog>
                    </p:outputPanel>
                </h:form>
            </div>
        </div>

        <div class="ui-fluid" style="margin-top: 5px;">
            <div class="card no-margin">
                <p:panelGrid columns="1" styleClass="ui-panelgrid-blank" layout="grid"
                             columnClasses="ui-grid-col-12 ui-no-margin-padding">
                    <p:outputPanel style="text-align: right" id="btnComplete">
                        <p:commandButton value="Hoàn tất" disabled="#{reportAuctionController.regulationReportFile.status eq DbConstant.REGULATION_REPORT_FILE_STATUS_FINISH}"
                                         style="width: auto; margin-right: 10px;" update="btnComplete growl"
                                         actionListener="#{reportAuctionController.endReportAuction()}"
                                         process="@this" icon="fa fa-check">
                            <p:confirm header="Thông báo"
                                       message="Sau khi bấm hoàn tất thì những người trúng đấu giá sẽ không thể chỉnh sửa file biên bản do họ tải lên. Bạn có chắc chắn với quyết định này?"
                                       icon="fa fa-question-circle"/>
                        </p:commandButton>
                        <p:commandButton value="Quay lại" styleClass="close"
                                         style="width: auto;"
                                         actionListener="#{reportAuctionController.backToReportAuction()}"
                                         process="@this" icon="fa fa-arrow-left">
                            <p:confirm header="Thông báo"
                                       message="Bạn có chắc chắn muốn thoát khỏi chức năng này hay không?"
                                       icon="fa fa-question-circle"/>
                        </p:commandButton>
                    </p:outputPanel>
                </p:panelGrid>
            </div>
        </div>

    </ui:define>
</ui:composition>
