<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:p="http://primefaces.org/ui"
                xmlns:h="http://java.sun.com/jsf/html"
                template="/admin/template/template.xhtml">

    <f:metadata>
        <f:event type="preRenderView" listener="#{dashboardController.initData}"/>
    </f:metadata>

    <ui:define name="breadcrumb">
        <li>
            <p:link outcome="/admin/dashboard">Chào mừng bạn tới trang quản trị của hệ thống đấu giá trực tuyến Đà Nẵng</p:link>
        </li>
        <li class="tutorial">
            <h:form>
                <p:commandLink value="Tải xuống tài liệu hướng dẫn" onclick="PrimeFaces.monitorDownload(start, stop);" ajax="false">
                    <p:fileDownload value="#{commonController.getFileDownload('/demo/document-tutorial/ĐGTT_HDSD_PMĐH.docx')}"/>
                </p:commandLink>
            </h:form>
        </li>
    </ui:define>

    <ui:define name="content">
        <style>
            h2 {
                text-align: center;
                font-weight: bold;
                color: rgba(86, 86, 86, 0.94);
                padding: 5px;
            }

            .hover-text {
                display: inline-block;
                font-size: 16px;
            }

            .hover-text:hover {
                color: greenyellow;
            }

            @media(max-width: 640px) {
                .card-left {
                    margin-left: 0 !important;
                    margin-top: 5px !important;
                }
            }
        </style>
        <div class="ui-g" style="height: auto">
            <div class="ui-g-12 no-padding">
                <div class="ui-fluid">
                    <div class="ui-g-12 no-padding">
                        <div class="ui-g-6 ui-md-6 ui-sm-12 no-padding">
                            <div class="card no-margin" style="min-height: 350px;">
                                <div class="card-header">
                                    <h2>Thông báo chung</h2>
                                </div>
                                <div class="ui-g-12">
                                    <h:form>
                                        <p>
                                            - Số thông tin đăng ký bán tài sản chưa xử lý:
                                            <h:commandLink actionListener="#{dashboardController.onClickAmountStoreReqNoProces()}">
                                                <span style="color: #dc0003;">
                                                    <b class="hover-text">#{dashboardController.getAmountStoreReqNoProcess()}</b>
                                                </span>
                                            </h:commandLink>
                                        </p>
                                        <p>
                                            - Số quy chế đã tạo chưa đăng tải:
                                            <h:commandLink actionListener="#{dashboardController.onClickAmountRegulationNotYetPosted()}">
                                                <span style="color: #dc0003;">
                                                    <b class="hover-text">#{dashboardController.getAmountRegulationNotYetPosted()}</b>
                                                </span>
                                            </h:commandLink>
                                        </p>
                                        <p>
                                            - Số lượng Người đăng ký tham gia đấu giá từ chối tham gia chưa trả lại tiền đặt trước:
                                            <h:commandLink actionListener="#{dashboardController.onClickAmountAutcionRegisterRefuse()}">
                                                <span style="color: #dc0003;">
                                                    <b class="hover-text">#{dashboardController.getAmountAutcionRegisterRefuse()}</b>
                                                </span>
                                            </h:commandLink>
                                        </p>
                                        <p>
                                            - Số lượng Người đăng ký tham gia đấu giá không hợp lệ chưa trả lại tiền đặt trước:
                                            <h:commandLink actionListener="#{dashboardController.onClickAmountAutcionRegisterRegistrationNotValid()}">
                                                <span style="color: #dc0003;">
                                                    <b class="hover-text">#{dashboardController.getAmountAutcionRegisterRegistrationNotValid()}</b>
                                                </span>
                                            </h:commandLink>
                                        </p>
                                        <p>
                                            - Số lượng người đăng ký tham gia đấu giá những tài sản Đã đấu giá/Đã tạm dừng chưa trả lại tiền đặt trước:
                                            <h:commandLink actionListener="#{dashboardController.onClickAmountStoreRegisterEndedAndCancel()}">
                                                <span style="color: #dc0003;">
                                                    <b class="hover-text">#{dashboardController.getAmountStoreRegisterEndedAndCancel()}</b>
                                                </span>
                                            </h:commandLink>
                                        </p>
                                        <p>
                                            - Số quy chế sắp diễn ra chưa phân công Đấu giá viên:
                                            <h:commandLink actionListener="#{dashboardController.onClickAmountStoreNotHasActioneer()}">
                                                <span style="color: #dc0003;">
                                                    <b class="hover-text">#{dashboardController.getAmountStoreNotHasStoreeer()}</b>
                                                </span>
                                            </h:commandLink>
                                        </p>
                                    </h:form>
                                </div>
                            </div>
                        </div>
                        <div class="ui-g-6 ui-md-6 ui-sm-12 no-padding">
                            <div class="card no-margin card-left" style="margin-left: 5px; min-height: 350px;">
                                <div class="card-header">
                                    <h2>Thống kê tình hình diễn ra các cuộc đấu giá</h2>
                                </div>
                                <div>
                                    <canvas height="300" id="myChart"/>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="ui-g-12 card no-margin" style="margin-top: 5px;">
                        <h:form>
                            <p:panelGrid columns="2" columnClasses="ui-grid-col-11 , ui-grid-col-1 no-padding"
                                         layout="grid"
                                         styleClass="ui-panelgrid-blank">
                                <p:outputLabel value="Năm: "
                                               style="float: right; margin-right: 5px; padding-top: 3px;"/>
                                <p:selectOneMenu value="#{dashboardController.selectedYear}" id="year">
                                    <f:selectItems value="#{dashboardController.listYear}"/>
                                    <p:ajax event="change" global="false" listener="#{dashboardController.onChange}"
                                            update="year barChart"/>
                                </p:selectOneMenu>
                            </p:panelGrid>
                        </h:form>
                        <p:barChart model="#{dashboardController.barModel}" id="barChart"/>
                    </div>
                </div>
            </div>
        </div>

        <script type="text/javascript">
            //<![CDATA[
            var data = [
                #{dashboardController.dashboardDoughnut.totalWaiting},
                #{dashboardController.dashboardDoughnut.totalPlaying},
                #{dashboardController.dashboardDoughnut.totalEnded},
                #{dashboardController.dashboardDoughnut.totalCanceled},
            ];
            var labels = [
                "Số cuộc đấu giá sắp diễn ra",
                "Số cuộc đấu giá đang diễn ra",
                "Số cuộc đấu giá đã kết thúc",
                "Số cuộc đấu giá đã tạm dừng",
            ];
            var bgColor = [
                "#3da2eb",
                "#FFEA88",
                "#a5a5a5",
                "#FF8153",
            ];

            var ctx = document.getElementById("myChart");

            var myChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: labels,
                    datasets: [{
                        data: data,
                        backgroundColor: bgColor,
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    legend: {
                        display: true,
                        position: 'top',
                        align: 'center',
                    }
                }
            });

            Chart.plugins.register({
                beforeDraw: function (chart) {
                    var width = chart.chart.width,
                        height = chart.chart.height,
                        ctx = chart.chart.ctx,
                        ctx1 = chart.chart.ctx,
                        type = chart.config.type;

                    if (type === 'doughnut') {
                        var percent = Math.round((chart.config.data.datasets[0].data[0] * 100) /
                            (chart.config.data.datasets[0].data[0] +
                                chart.config.data.datasets[0].data[1]));
                        var oldFill = ctx.fillStyle;
                        var oldFill1 = ctx1.fillStyle;
                        var total = 0;
                        for (var i = 0; i < data.length; i++) {
                            total += chart.config.data.datasets[0].data[i];
                        }
                        var xWidth = 1;
                        if (total < 100) xWidth = 0;
                        if (total < 10)  xWidth = -2;

                        var text = new Intl.NumberFormat().format(total),
                            textX = Math.round((width - ctx.measureText(text).width * xWidth - 25) / 2),
                            textY = (height + chart.chartArea.top) / 2;
                        var fontSize = ((height - chart.chartArea.top - ctx.measureText(text).width - 50) / 100).toFixed(2);

                        ctx.restore();
                        ctx.font = fontSize + "em sans-serif";
                        ctx.fontWeight = "bold";
                        ctx.textBaseline = "middle";

                        ctx.fillStyle = "red";
                        ctx.fillText(text, textX, textY + 15);
                        ctx.fillStyle = oldFill;
                        ctx.save();

                        // total text
                        ctx1.restore();
                        ctx1.font = "1.43em sans-serif";
                        ctx1.textBaseline = "middle";
                        ctx1.fillStyle = "#3A3A3A";
                        ctx1.fillText("Tổng số", (width - 70) / 2, textY - 15);
                        ctx1.fillStyle = oldFill1;
                        ctx1.save();
                    }
                }
            });
            //]]>
        </script>
    </ui:define>

</ui:composition>
