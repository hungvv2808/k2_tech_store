<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:p="http://primefaces.org/ui"
                template="/admin/template/template.xhtml">

    <f:metadata>
        <f:event type="preRenderView" listener="#{accountController.initData(false)}"/>
    </f:metadata>

    <ui:define name="title">Quản lý tài khoản đấu giá - người có tài sản</ui:define>

    <ui:define name="breadcrumb">
        <li>
            <p:link outcome="/admin/quan-ly-nguoi-dung/quan-ly-nguoi-dung">Quản trị hệ thống / Tài khoản đấu giá/người có tài sản</p:link>
        </li>
    </ui:define>

    <ui:define name="content">
        <p:outputPanel styleClass="ui-g" rendered="#{accountController.getActions().canCreate()}">
            <div class="ui-g-12">
                <div class="card no-margin">
                    <p:commandButton value="Thêm mới" icon="fa fa-plus"
                                     actionListener="#{accountController.resetDialog}"
                                     oncomplete="PF('dialogInsertUpdate').show();" update="dlg"/>
                </div>
            </div>
        </p:outputPanel>

        <p:dialog id="dlg" header="Thông tin tài khoản đấu giá/người có tài sản" widgetVar="dialogInsertUpdate"
                  modal="true" width="900" position="center"
                  style="max-height: 90vh; max-width: 90vw"
                  rendered="#{accountController.getActions().hasAction(EAction.CREATE,EAction.UPDATE)}">
            <p:tabView activeIndex="#{accountController.tabindex}">
                <p:ajax event="tabChange" listener="#{accountController.onTabChange()}"/>
                <p:tab title="Cá nhân" style="max-height: 500px;">
                    <h:form id="dlForm1">
                        <div class="ui-fluid">
                            <p:outputPanel>
                                <ui:include src="/common/them-tai-khoan-ca-nhan.xhtml"/>
                            </p:outputPanel>
                        </div>
                    </h:form>
                </p:tab>
                <p:tab title="Tổ chức" style="max-height: 500px;">
                    <h:form id="dlForm2">
                        <div class="ui-fluid">
                            <p:outputPanel>
                                <ui:include src="/common/them-tai-khoan-to-chuc.xhtml"/>
                            </p:outputPanel>
                        </div>
                    </h:form>
                </p:tab>
            </p:tabView>
        </p:dialog>

        <h:form id="searchForm">
            <div class="ui-fluid">
                <div class="ui-g">
                    <div class="ui-g-12" style="padding-top:0">
                        <div class="card no-margin">
                            <p:panel id="searchCode" header="Tìm kiếm người dùng" style="margin-bottom:5px"
                                    rendered="#{accountController.getActions().canSearch()}">
                                <p:panelGrid id="searchPanel" columns="4"
                                             columnClasses="ui-grid-col-2,ui-grid-col-4,ui-grid-col-2,ui-grid-col-4"
                                             styleClass="ui-panelgrid-blank" layout="grid">
                                    <p:outputLabel value="Tên cá nhân/tổ chức: "
                                                   for="smanhomquyen"/>
                                    <p:inputText id="smanhomquyen"
                                                 placeholder="Nhập tên cá nhân, tổ chức"
                                                 value="#{accountController.accountSearchDto.keyword}"/>

                                    <p:outputLabel value="Số CMND/CCCD:"
                                                   for="scmnd"/>
                                    <p:inputText id="scmnd"
                                                 placeholder="Nhập số CMND/CCCD"
                                                 value="#{accountController.accountSearchDto.idCardNumber}"/>

                                    <p:outputLabel value="Loại hình đăng ký:" for="org"/>
                                    <p:selectOneMenu id="org"
                                                     value="#{accountController.accountSearchDto.org}">
                                        <f:selectItem itemLabel="Tất cả" itemValue=""/>
                                        <f:selectItem itemLabel="Cá nhân" itemValue="#{DbConstant.PESONAL}"/>
                                        <f:selectItem itemLabel="Tổ chức" itemValue="#{DbConstant.ORGANIZATION}"/>
                                    </p:selectOneMenu>
                                    <p:outputLabel value="Số điện thoại:"
                                                   for="sPhone"/>
                                    <p:inputText id="sPhone"
                                                 placeholder="Nhập số điện thoại"
                                                 value="#{accountController.accountSearchDto.phone }"/>

                                    <p:outputLabel value="Tên đăng nhập:"
                                                   for="sUserName"/>
                                    <p:inputText id="sUserName"
                                                 placeholder="Nhập tên đăng nhập"
                                                 value="#{accountController.accountSearchDto.username}"/>

                                    <p:outputLabel value="Trạng thái:" for="sStatus"/>
                                    <p:selectOneMenu id="sStatus"
                                                     value="#{accountController.accountSearchDto.accountStatus}">
                                        <f:selectItem itemLabel="Tất cả" itemValue=""/>
                                        <f:selectItem itemLabel="Đã kích hoạt" itemValue="#{DbConstant.ACCOUNT_ACTIVE_STATUS}"/>
                                        <f:selectItem itemLabel="Chưa kích hoạt" itemValue="#{DbConstant.ACCOUNT_INACTIVE_STATUS}"/>
                                        <f:selectItem itemLabel="Đã bị khóa" itemValue="#{DbConstant.ACCOUNT_LOCK_STATUS}"/>
                                    </p:selectOneMenu>
                                </p:panelGrid>
                                <p:panelGrid columns="3"
                                             columnClasses="ui-grid-col-1.5,ui-grid-col-1.5,ui-grid-col-1.5"
                                             styleClass="ui-panelgrid-blank" layout="grid">
                                    <p:commandButton value="Tìm kiếm"
                                                     actionListener="#{accountController.onSearch()}"
                                                     update="searchForm tblSearchResult" icon="fa fa-search"
                                                     style="width: auto"/>
                                    <p:commandButton value="Làm mới"
                                                     actionListener="#{accountController.resetAll()}"
                                                     update="searchForm tblSearchResult" icon="fa fa-refresh"
                                                     styleClass="orange-btn" style="width: auto"/>
                                    <p:commandButton value="Xuất dữ liệu" icon="fa fa-copy" update="growl" ajax="false" rendered="#{accountController.lazyDataModel.rowCount gt 0}">
                                        <p:dataExporter type="xlsxstream" target="tblSearchResult" fileName="Danh sách thông tin người dùng" />
                                    </p:commandButton>
                                </p:panelGrid>
                            </p:panel>

                            <p:dataTable id="tblSearchResult" tableStyle="table-layout: auto;"
                                         widgetVar="wdgProvince" resizableColumns="true" paginator="true"
                                         rows="10"
                                         value="#{accountController.lazyDataModel}"
                                         lazy="true" pageLinks="5" paginatorPosition="top" var="resultDto"
                                         paginatorAlwaysVisible="true" rowsPerPageTemplate="10,20,50,100"
                                         paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                                         currentPageReportTemplate="#{t['lbl.recordTotal']}: #{accountController.lazyDataModel.rowCount}"
                                         emptyMessage="#{t['lbl.emptyTable']}" rowIndexVar="rowIndex"
                                         rowKey="#{resultDto.accountDtoId}">

                                <p:column headerText="Chi tiết" width="20" rendered="#{accountController.getActions().canDetail()}">
                                    <p:rowToggler/>
                                </p:column>

                                <p:rowExpansion>
                                    <p:panelGrid id="detail-content" columns="4" layout="grid"
                                                 styleClass="ui-panelgrid-blank"
                                                 columnClasses="ui-grid-col-2,ui-grid-col-4,ui-grid-col-2,ui-grid-col-4">

                                        <p:outputLabel value="Tên tổ chức: " rendered="#{resultDto.org}"/>
                                        <h:outputText value="#{resultDto.orgName}" rendered="#{resultDto.org}"/>

                                        <p:outputLabel value="Số DKKD: " rendered="#{resultDto.org}"/>
                                        <h:outputText value="#{resultDto.businessLicense}" rendered="#{resultDto.org}"/>

                                        <p:outputLabel value="Địa chỉ tổ chức: " rendered="#{resultDto.org}"/>
                                        <h:outputText value="#{resultDto.orgAddress}" rendered="#{resultDto.org}"/>

                                        <p:outputLabel value="Người đại diện: " rendered="#{resultDto.org}"/>
                                        <p:outputLabel value="Họ và tên: " rendered="#{!resultDto.org}"/>
                                        <h:outputText value="#{resultDto.fullName}" />

                                        <p:outputLabel value="Chức danh: " rendered="#{resultDto.org}"/>
                                        <h:outputText value="#{resultDto.position}" rendered="#{resultDto.org}"/>

                                        <p:outputLabel value="Số điện thoại: "/>
                                        <h:outputText value="#{resultDto.phone}"/>

                                        <p:outputLabel value="Tên đăng nhập: "/>
                                        <h:outputText value="#{resultDto.username}"/>

                                        <p:outputLabel value="Giới tính: "/>
                                        <h:outputText value="" rendered="#{resultDto.sex eq null}"/>
                                        <h:outputText value="Nam" rendered="#{DbConstant.MAN eq resultDto.sex}"/>
                                        <h:outputText value="Nữ" rendered="#{DbConstant.WOMAN eq resultDto.sex}"/>
                                        <h:outputText value="Giới tính khác" rendered="#{DbConstant.UNKNOW eq resultDto.sex}"/>

                                        <p:outputLabel value="Địa chỉ email: "/>
                                        <h:outputText value="#{resultDto.email}"/>

                                        <p:outputLabel value="Ngày sinh: "/>
                                        <h:outputText value="#{resultDto.dateOfBirth}">
                                            <f:convertDateTime pattern="dd/MM/yyyy"/>
                                        </h:outputText>

                                        <p:outputLabel value="Địa chỉ: "/>
                                        <h:outputText value="#{resultDto.nameProvice}"/>

                                        <p:outputLabel value="Số CMND/CCCD: "/>
                                        <h:outputText value="#{resultDto.idCardNumber}"/>

                                        <p:outputLabel value="Hộ khẩu thường trú: "/>
                                        <h:outputText value="#{resultDto.permanentResidence}"/>

                                        <ui:include src="/common/accuracy.xhtml">
                                                <ui:param name="resultDto" value="#{resultDto}"/>
                                        </ui:include>
                                    </p:panelGrid>
                                </p:rowExpansion>

                                <p:column headerText="STT" width="30" style="text-align: center">
                                    <h:outputText value="#{rowIndex + 1}"/>
                                </p:column>

                                <p:column headerText="Tên CN/TC" visible="false" width="12%">
                                    <h:outputText value="#{resultDto.orgName}" rendered="#{resultDto.org}"/>
                                    <h:outputText value="#{resultDto.fullName}" rendered="#{!resultDto.org}"/>
                                </p:column>

                                <p:column headerText="Tên CN/TC" exportable="false" width="12%">
                                    <u><p:commandLink value="#{resultDto.fullName}" rendered="#{!resultDto.org}"
                                                      actionListener="#{accountController.onClickDetail(resultDto)}"/></u>
                                    <u><p:commandLink value="#{resultDto.orgName}" rendered="#{resultDto.org}"
                                                      actionListener="#{accountController.onClickDetail(resultDto)}"/></u>
                                </p:column>

                                <p:column headerText="Loại hình đăng ký" sortBy="#{resultDto.org}" width="10%">
                                    <h:outputText value="Tổ chức" rendered="#{resultDto.org}"/>
                                    <h:outputText value="Cá nhân" rendered="#{!resultDto.org}"/>
                                </p:column>

                                <p:column headerText="Tên đăng nhập" sortBy="#{resultDto.username}" width="10%">
                                    <h:outputText value="#{resultDto.username}"/>
                                </p:column>

                                <p:column headerText="Số CMND/CCCD" sortBy="#{resultDto.idCardNumber}" width="10%">
                                    <h:outputText value="#{resultDto.idCardNumber}" />
                                </p:column>

                                <p:column headerText="Số điện thoại" sortBy="#{resultDto.phone}" width="10%" style="text-align: center">
                                    <h:outputText value="#{resultDto.phone}" rendered="#{!resultDto.org}"/>
                                    <h:outputText value="#{resultDto.orgPhone} " rendered="#{resultDto.org}"/>
                                </p:column>

                                <p:column headerText="Email" sortBy="#{resultDto.email}">
                                    <h:outputText value="#{resultDto.email}"/>
                                </p:column>

                                <p:column headerText="Ngày tạo" sortBy="#{resultDto.createDate}" width="10%" style="text-align: center">
                                    <h:outputText value="#{resultDto.createDate}">
                                        <f:convertDateTime pattern="dd/MM/yyyy"/>
                                    </h:outputText>
                                </p:column>

                                <p:column headerText="Trạng thái" sortBy="#{resultDto.accountStatus}" width="10%">
                                    <h:outputText value="Đã kích hoạt" rendered="#{resultDto.accountStatus eq DbConstant.ACCOUNT_ACTIVE_STATUS}"/>
                                    <h:outputText value="Chưa kích hoạt" rendered="#{resultDto.accountStatus eq DbConstant.ACCOUNT_INACTIVE_STATUS}"/>
                                    <h:outputText value="Đã bị khóa" rendered="#{resultDto.accountStatus eq DbConstant.ACCOUNT_LOCK_STATUS}"/>
                                </p:column>

                                <p:column headerText="Thao tác" width="40" exportable="false">
                                    <p:menuButton icon="fa fa-cogs">
                                        <p:menuitem value="Khóa tài khoản" action="#{accountController.onLock(resultDto)}"
                                                    update="searchForm #{Constant.ERROR_GROWL_ID}"
                                                    icon="fa fa-check-circle"
                                                    rendered="#{accountController.getActions().hasAction(EAction.ACTIVE_BLOCK) and resultDto.accountStatus eq DbConstant.ACCOUNT_ACTIVE_STATUS}">
                                            <p:confirm header="Xác nhận khóa tài khoản"
                                                       message="Bạn chắc chắn muốn khóa tài khoản này"
                                                       icon="fa fa-question-circle"/>
                                        </p:menuitem>
                                        <p:menuitem value="Mở khóa tài khoản"
                                                    action="#{accountController.onUnlock(resultDto)}"
                                                    update="searchForm #{Constant.ERROR_GROWL_ID}"
                                                    icon="fa fa-check-circle"
                                                    rendered="#{accountController.getActions().hasAction(EAction.ACTIVE_BLOCK) and resultDto.accountStatus eq DbConstant.ACCOUNT_LOCK_STATUS}">
                                            <p:confirm header="Xác nhận kích hoạt tài khoản"
                                                       message="Bạn chắc chắn muốn kích hoạt tài khoản này"
                                                       icon="fa fa-question-circle"/>
                                        </p:menuitem>
                                        <p:menuitem value="Kích hoạt tài khoản"
                                                    action="#{accountController.onUnlock(resultDto)}"
                                                    update="searchForm #{Constant.ERROR_GROWL_ID}"
                                                    icon="fa fa-check-circle"
                                                    rendered="#{accountController.getActions().hasAction(EAction.ACTIVE_BLOCK) and resultDto.accountStatus eq DbConstant.ACCOUNT_INACTIVE_STATUS}">
                                            <p:confirm header="Xác nhận kích hoạt tài khoản"
                                                       message="Bạn chắc chắn muốn kích hoạt tài khoản này"
                                                       icon="fa fa-question-circle"/>
                                        </p:menuitem>
                                        <p:menuitem value="Sửa thông tin"
                                                    rendered="#{accountController.getActions().canUpdate()}"
                                                    action="#{accountController.showUpdatePopup(resultDto)}"
                                                    oncomplete="PF('dialogInsertUpdate').show();"
                                                    update="dlg #{Constant.ERROR_GROWL_ID}" icon="fa fa-edit"/>
                                    </p:menuButton>
                                </p:column>
                            </p:dataTable>
                        </div>
                    </div>
                </div>
            </div>
        </h:form>
    </ui:define>
</ui:composition>
