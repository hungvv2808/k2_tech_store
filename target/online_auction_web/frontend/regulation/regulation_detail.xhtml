<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:c="http://java.sun.com/jsp/jstl/core"
                xmlns:p="http://primefaces.org/ui"
                template="/frontend/template/template_detail.xhtml">

    <f:metadata>
        <f:event type="preRenderView" listener="#{regulationIsInFinishController.initData}"/>
    </f:metadata>

    <ui:define name="title">Chi tiết quy chế</ui:define>
    <ui:param name="bodyStyleClass" value="document-page"/>
    <ui:param name="headerStyleClass" value="is-sticky fixed-header"/>
    <ui:param name="mainStyleClass" value="regulation_detail"/>

    <ui:define name="breadcrumb">
        <li>#{regulationIsInFinishController.regulationDetail.code}</li>
    </ui:define>

    <ui:define name="screenTitle" var="dtc">
        <h2>#{regulationIsInFinishController.regulationDetail.code}</h2>
    </ui:define>

    <ui:define name="content">
        <div class="row">
            <div class="col-md-9 col-sm-12 col-xs-12 help-documents">
                <h:form>
                    <div class="document-viewer">
                        <object data="#{request.contextPath}/resources#{regulationIsInFinishController.regulationFile.filePath}"
                                type="application/pdf" width="100%" height="1100px">
                            <p>Nếu trình duyệt của bạn không có PDF plugin.
                                Đừng lo bạn có thể <a href="#{request.contextPath}/resources#{regulationIsInFinishController.regulationFile.filePath}">Nhấn vào đây để tải xuống file PDF.</a>
                            </p>
                        </object>
                    </div>
                </h:form>
            </div>

            <div class="col-md-3 col-sm-12 col-xs-12 sidebar mb-f-r">
                <h:panelGroup id="regulation-countdown" layout="block" styleClass="product-info row">
                    <h:panelGroup styleClass="time-wrap col-md-12 col-xs-12 col-sm-4 mb-text-center">
                        <div class="icon-product">
                            <img src="#{resource['frontend-layout:images/count-down.svg']}"/>
                        </div>

                        <div class="future-product">
                            <h:form rendered="#{regulationIsInFinishController.regulationDetail.auctionStatus eq DbConstant.REGULATION_AUCTION_STATUS_WAITING and regulationIsInFinishController.regulationDetail.status eq DbConstant.REGULATION_STATUS_PUBLIC}">
                                <div class="countdown-wrapper">
                                    <p>Thời gian bắt đầu đấu giá còn</p>
                                    <div class="pts-countdown clearfix"
                                         data-countdown="countdown"
                                         data-countup="false"
                                         data-date="#{regulationIsInFinishController.formatDate(regulationIsInFinishController.regulationDetail.startTime)}">
                                    </div>
                                </div>
                            </h:form>
                        </div>

                        <div class="now-product">
                            <h:form rendered="#{regulationIsInFinishController.regulationDetail.auctionStatus eq DbConstant.REGULATION_AUCTION_STATUS_PLAYING and regulationIsInFinishController.regulationDetail.status eq DbConstant.REGULATION_STATUS_PUBLIC}">
                                <div class="countdown-wrapper">
                                    <p>Thời gian kết thúc còn</p>
                                    <div class="pts-countdown clearfix"
                                         data-countdown="countdown"
                                         data-countup="true"
                                         data-date="#{regulationFEController.formatDate(regulationIsInFinishController.regulationDetail.startTime)}">
                                    </div>
                                </div>
                            </h:form>
                        </div>

                        <div class="ended-product">
                            <h:form rendered="#{regulationIsInFinishController.regulationDetail.auctionStatus eq DbConstant.REGULATION_AUCTION_STATUS_ENDED and regulationIsInFinishController.regulationDetail.status eq DbConstant.REGULATION_STATUS_PUBLIC}">
                                <div class="countdown-wrapper">
                                    <p class="end-status">Đấu giá đã kết thúc</p>
                                </div>
                            </h:form>
                        </div>

                        <div class="stoped-product">
                            <h:form rendered="#{regulationIsInFinishController.regulationDetail.auctionStatus eq DbConstant.REGULATION_AUCTION_STATUS_CANCELLED or regulationIsInFinishController.regulationDetail.status eq DbConstant.REGULATION_STATUS_CANCELED}">
                                <div class="countdown-wrapper">
                                    <p class="end-status">Đấu giá đã tạm dừng</p>
                                </div>
                            </h:form>
                        </div>
                    </h:panelGroup>

                    <div class="time-start col-md-12 col-xs-12 col-sm-4 mb-text-center">
                        <div class="icon-product">
                            <img src="#{resource['frontend-layout:images/time-registed.svg']}"/>
                        </div>
                        <div class="info">
                            <p>Thời gian đăng ký đấu giá</p>
                            <p><b><h:outputText value="#{regulationIsInFinishController.regulationDetail.startRegistrationDate}"><f:convertDateTime pattern="HH:mm, dd/MM/yyyy"/></h:outputText></b><br/> đến <b><h:outputText value="#{regulationIsInFinishController.regulationDetail.endRegistrationDate}"><f:convertDateTime pattern="HH:mm, dd/MM/yyyy"/></h:outputText></b></p>
                        </div>
                    </div>

                    <div class="time-start col-md-12 col-xs-12 col-sm-4 mb-text-center">
                        <div class="icon-product">
                            <img src="#{resource['frontend-layout:images/clock.svg']}"/>
                        </div>
                        <div class="info">
                            <p>Thời gian bắt đầu tổ chức đấu giá</p>
                            <p><b><h:outputText
                                    value="#{regulationIsInFinishController.regulationDetail.startTime}"><br/><f:convertDateTime pattern="HH:mm, dd/MM/yyyy"/></h:outputText></b></p>
                        </div>
                    </div>
                    <h:panelGroup rendered="#{regulationIsInFinishController.regulationDetail.auctionFormalityId eq DbConstant.AUCTION_FORMALITY_ID_POLL}">
                        <div class="circle col-md-12 col-xs-12 col-sm-4 mb-text-center">
                            <div class="icon-product">
                                <img src="#{resource['frontend-layout:images/circle.svg']}"/>
                            </div>
                            <div class="info">
                                <p>Số vòng đấu giá</p>
                                <p><b>#{regulationIsInFinishController.regulationDetail.numberOfRounds}</b></p>
                            </div>
                        </div>
                    </h:panelGroup>

                    <h:panelGroup rendered="#{regulationIsInFinishController.regulationDetail.auctionStatus eq DbConstant.REGULATION_AUCTION_STATUS_CANCELLED or regulationIsInFinishController.regulationDetail.status eq DbConstant.REGULATION_STATUS_CANCELED}">
                        <div class="regulation-asset">
                            <ui:include src="modal/modal_cancel_regulation.xhtml"/>
                            <a class="btn btn-custom status-button canceled mt-10" data-toggle="modal" data-target="#regulationPopup">Xem lý do tạm dừng quy chế</a>
                        </div>
                    </h:panelGroup>
                </h:panelGroup>

                <aside class="widget widget_asset_regulation">
                    <div class="title-widget has-divider ">
                        <h3 class="title-sidebar "><span>Tài sản trong quy chế</span></h3>
                    </div>
                    <div class="row">
                        <div class="col-lg-12 col-md-12 col-xs-12 col-sm-6 regulation-asset">
                            <h:form id="asset-area" prependId="false">
                                <div class="list-area">
                                    <ui:repeat value="#{regulationIsInFinishController.assetDtoList}" var="asset">
                                        <div class="product-one-columns ">
                                            <div class="col-lg-12 col-md-12 col-xs-12 col-sm-12 no-padding">
                                                <div class="product-image end-product">
                                                    <h:link outcome="/frontend/asset/asset_detail.xhtml?id=#{asset.assetId}">
                                                        <div class="img-news">
                                                            <img src="#{resource[asset.filePaths.get(0)]}"/>
                                                        </div>
                                                        <div class="middle">
                                                            <div class="text"><i class="fa fa-eye" aria-hidden="true"/>Xem chi tiết</div>
                                                        </div>
                                                    </h:link>
                                                </div>
                                            </div>
                                            <div class="col-lg-12 col-md-12 col-xs-12 col-sm-12 no-padding">
                                                <div class="product-info">
                                                    <h:link outcome="/frontend/asset/asset_detail.xhtml?id=#{asset.assetId}"
                                                            value="#{asset.name}"
                                                            style="text-align: justify" title="#{asset.name}">
                                                        <f:ajax execute="@form"/>
                                                    </h:link>
                                                    <p style="margin-top: 10px;"><span>Giá khởi điểm</span>
                                                        <ins><h:outputText value="#{asset.startingPrice}">
                                                            <f:convertNumber type="currency" currencySymbol="VNĐ" maxFractionDigits="6" minFractionDigits="0" locale="vi_VN"/>
                                                        </h:outputText></ins>
                                                    </p>
                                                </div>
                                            </div>
                                            <div class="col-lg-12 col-md-12 col-xs-12 col-sm-12 no-padding" style="margin-bottom: 10px;">
                                                <h:panelGroup rendered="#{regulationIsInFinishController.showButtonRegister(asset)}">
                                                    <h:commandButton type="submit" class="btn btn-custom main-color mt-10" value="Đăng ký tham gia" actionListener="#{regulationIsInFinishController.signUpToJoin(asset)}">
                                                        <f:ajax execute="@form" render="@form #{Constant.ERROR_FE_GROWL_ID} :auction_register_form_register"/>
                                                    </h:commandButton>
                                                </h:panelGroup>

                                                <h:panelGroup rendered="#{asset.status eq DbConstant.ASSET_STATUS_CANCELED}">
                                                    <a class="btn btn-custom status-button canceled mt-10 disabled">Tạm dừng đấu giá</a>
                                                </h:panelGroup>

                                                <h:panelGroup rendered="#{asset.status eq DbConstant.ASSET_STATUS_ENDED and asset.assetManagementEnding}">
                                                    <a class="btn btn-custom status-button successed mt-10 disabled">
                                                        <span class="l-float">Giá trúng đấu giá</span>
                                                        <span class="r-float">
                                                            <ins>
                                                                <h:outputText value="#{asset.money}">
                                                                    <f:convertNumber type="currency" currencySymbol="VNĐ"
                                                                                     maxFractionDigits="6"
                                                                                     minFractionDigits="0" locale="vi_VN"/>
                                                                </h:outputText>
                                                            </ins>
                                                        </span>
                                                    </a>
                                                </h:panelGroup>

                                                <h:panelGroup rendered="#{asset.status eq DbConstant.ASSET_STATUS_ENDED and !asset.assetManagementEnding}">
                                                    <a class="btn status-button failed mt-10 disabled">Đấu giá không thành</a>
                                                </h:panelGroup>

                                                <h:panelGroup rendered="#{regulationIsInFinishController.regulationDetail.auctionStatus eq DbConstant.REGULATION_AUCTION_STATUS_WAITING and not empty asset.auctionRegisterId}">
                                                    <h:outputLabel class="btn btn-custom status-button registed mt-10 disabled" rendered="#{asset.auctionRegisterStatus eq DbConstant.AUCTION_REGISTER_STATUS_ACCEPTED}">Đã đăng ký tham gia đấu giá</h:outputLabel>
                                                    <h:outputLabel class="btn btn-custom status-button canceled mt-10 disabled" rendered="#{asset.auctionRegisterStatus eq DbConstant.AUCTION_REGISTER_STATUS_REJECTED}">Đăng ký bị từ chối</h:outputLabel>
                                                </h:panelGroup>
                                            </div>
                                        </div>
                                    </ui:repeat>
                                </div>
                            </h:form>
                        </div>
                        <p class="view-more">
                            <h:link outcome="/frontend/asset/asset_list.xhtml?regulationId=#{regulationIsInFinishController.regulationId}"
                                    style="text-align: right; color: #F19B40"
                                    value="Xem tất cả"
                                    aria-hidden="true">
                                <i class="fa fa-angle-double-right"/>
                            </h:link>
                        </p>
                    </div>
                </aside>
            </div>
        </div>
        <ui:include src="/frontend/asset/common/modal/modal_register_auction.xhtml"/>

        <h:panelGroup rendered="#{regulationIsInFinishController.regulationDetail.status eq DbConstant.REGULATION_STATUS_CANCELED}">
            <ui:include src="modal/modal_cancel_regulation.xhtml"/>
        </h:panelGroup>

        <!--auto update button-->
        <h:panelGroup id="countdownScript">
            <c:set var="countdown" value="#{regulationIsInFinishController.countdownShowButton()}"/>
            <h:outputScript rendered="#{countdown ne -1}">
                setTimeout(function() {
                    cmdRefreshRegisterButton();
                }, #{countdown});
            </h:outputScript>
        </h:panelGroup>

        <!--Update area-->
        <p:remoteCommand name="cmdRefreshData" update="regulation-countdown asset-area #{Constant.ID_COUNTDOWN_LIBRARY}"
                         global="false"
                         actionListener="#{regulationIsInFinishController.resetAll()}"/>
        <!-- button register -->
        <p:remoteCommand name="cmdRefreshRegisterButton" update="asset-area countdownScript" global="false"/>

        <script>var myAuction = false;</script>
    </ui:define>
</ui:composition>
